# 5장 : 패키지 매니저

# 5.1 npm 알아보기

- **npm** : Node Package Manager
- 대부분의 자바스크립트 프로그램은 패키지라는 이름으로 npm에 등록되어 있음
- npm에는 2022년 4월 기준 193만 개에 달하는 패키지가 등록되어 있음
- 패키지 : npm에 업로드 된 노드 모듈
    - 모듈이 다른 모듈을 사용할 수 있는 것처럼, 패키지가 다른 패키지를 사용할 수도 있음 → **의존관계**

# 5.2 package.json으로 패키지 관리하기

- **package.json** : 설치한 패키지의 버전을 관리하는 파일
- 노드 프로젝트를 시작하기 전에는 폴더 내부에 무조건 package.json부터 만들고 시작해야 함
- npm은 package.json을 만드는 명령어를 제공
- 구성
    - `package name` : 패키지의 이름
    - `version` : 패키지의 버전
    - `entry point` : 자바스크립트 실행 파일 진입점, 보통 module.exports를 하는 파일을 저장
    - `test command` : 코드를 테스트할 때 입력할 명령어
    - `git repository` : 코드를 저장해둔 깃(Git) 저장소 주소
    - `keywords` : npm 공식 홈페이지에서 패키지를 쉽게 찾을 수 있게 함
    - `license` : 해당 패키지의 라이선스
- 프로젝트 이름과 설치하는 패키지 이름은 달라야 함
    - express라는 패키지를 설치했을 때 프로젝트 이름(package.json의 name)은 express여서는 안 됨
- **package-lock.json** : 패키지 간의 의존관계를 명시한 파일

- 모듈 여러 개를 동시에 설치 : `npm install [패키지1] [패키지2] […]`
- 개발용 패키지 설치 : `npm install --save-dev [패키지] […]`
- `--save-dev`가 개발용 패키지임을 나타냄
    - package.json 파일에서 **devDependencies** 속성에서는 개발용 패키지들만 따로 관리
- **peerDependencies**와 다른 버전이 설치되어 있다면 `ERESOLVE unable to resolve dependency tree` 에러 메시지가 표시
- 동시에 사용하는 여러 패키지의 peerDependencies가 다른 경우 두 가지 방법 중 선택
    - `npm i --force`를 통해 강제로 모든 버전을 설치
    - `npm i --legacy-peer-deps`로 peerDependencies를 무시
- npm에는 **전역(global) 설치 옵션**도 존재 : 패키지를 npm이 설치되어 있는 폴더에 설치
    - 전역 설치한 패키지는 콘솔의 명령어로 사용 가능

# 5.3 패키지 버전 이해하기

- 노드 패키지들의 버전은 항상 세 자리로 이루어져 있음 → SemVer 방식의 버전 넘버링을 따르기 때문
    - SemVer : Semantic Versioning(유의적 버전), 버전을 구성하는 세 자리가 모두 의미를 갖고 있다는 뜻
    - 첫 번째 자리 : 메이저(major) 버전, 0이면 초기 개발 중 / 1부터는 정식 버전, 하위 호환이 안 될 정도로 패키지의 내용이 수정되었을 때 올림 ex. 1.5.0 → 2.0.0
    - 두 번째 자리 : 마이너(minor) 버전, 하위 호환이 되는 기능 업데이트를 할 때 올림
    - 세 번째 자리 : 패치(patch) 버전 : 기존 기능에 문제가 있어 수정한 것을 내놓았을 때 올림
- package.json에는 세 버전 외에도 버전 앞에 ^이나 ~ 또는 >, < 같은 문자가 붙어 있음
    - 설치하거나 업데이트할 때 어떤 버전을 설치해야 하는지 알림
    - ^ : 마이너 버전까지만 설치하거나 업데이트 ex. `express@^ 1.1.1` : 1.1.1 이상부터 2.0.0 미만 버전까지 설치
    - ~ : 패치 버전까지만 설치하거나 업데이트
    - >, <, ≥, ≤, = : 초과, 미만, 이상, 이하, 동일을 의미
    - @latest : 안정된 최신 버전의 패키지 설치, x로도 표현
    - @next : 가장 최근 배포판 설치(안정되지 않은 알파나 베타 버전의 패키지를 설치할 수 있음)

# 5.4 기타 npm 명령어

- Current와 Wanted가 다르다면 업데이트가 필요한 경우 → `npm update [패키지 이름]`으로 업데이트
    - `npm update`를 하면 업데이트 가능한 모든 패키지가 Wanted에 적힌 버전으로 업데이트됨
- `npm uninstall [패키지 이름]` or `npm rm [패키지 이름]` : 해당 패키지를 제거, node_modules 폴더와 package.json에서 사라짐
- `npm search [검색어]` : npm의 패키지 검색
- `npm info [패키지 이름]` : 패키지의 세부 정보를 파악하고자 할 때 사용
- `npm login` : npm 로그인을 위한 명령어
- `npm whoami` : 로그인한 사용자가 누구인지 알림, 로그인된 상태가 아니라면 에러 발생
- `npm logout` : npm login으로 로그인한 계정을 로그아웃
- `npm version [버전]` : package.json의 버전을 올림, 원하는 버전의 숫자를 넣거나 major, minor, patch라는 문자열을 넣어서 해당 부분의 숫자를 1 올릴 수도 있음
- `npm deprecate [패키지 이름] [버전] [메시지]` : 해당 패키지를 설치할 때 경고 메시지를 띄우게 하는 명령어, 자신의 패키지에만 이 명령어를 적용할 수 있음, 다른 사용자들이 버그가 있는 버전의 패키지를 설치할 때 경고 메시지가 출력됨
- `npm publish` : 자신이 만든 패키지를 배포할 때 사용
- `npm unpublish` : 배포한 패키지를 제거, 24시간 이내에 배포한 패키지만 제거 가능(의존성 관계 때문)

# 5.5 패키지 배포하기

- npm은 패키지의 이름이 겹치는 것을 허용하지 않음
- 남이 사용하는 패키지 이름으로 배포하고 싶다면 **네임스페이스** 사용
- 누군가가 이름을 사용하고 있는지 확인하려면 `npm info [패키지 이름]`을 콘솔에 입력하여 확인
    - 정보가 나온다면 누군가가 사용하고 있는 이름이고, `npm ERROR! code E404` 에러가 발생한다면 사용해도 좋은 이름
- 패키지를 삭제할 때는 `npm unpublish [패키지 이름] --force` 명령어 사용
    - 삭제 후 npm info 명령어를 사용해 확인